{% extends 'base.twig' %}

{% block content %}
<div class="question-container" id="question-container">
  <div class="muted">Pergunta {{ number }} de {{ total }}</div>
  <h1>{{ question.title }}</h1>

  <form method="post" action="{{ nextPost }}" autocomplete="off" id="question-form">
    <div class="options">
      {% for opt in question.options %}
        <label>
          <input type="radio" name="answer" value="{{ opt.id }}"> {{ opt.text }}
        </label>
      {% endfor %}
    </div>

    <div class="row">
      <button class="primary" id="submit-btn" disabled>Responder</button>
    </div>
  </form>
</div>

{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const form = document.getElementById('question-form');
  const submitBtn = document.getElementById('submit-btn');
  const radioButtons = document.querySelectorAll('input[type="radio"]');
  const container = document.getElementById('question-container');
  
  // Clear any pre-selected radio buttons
  radioButtons.forEach(rb => rb.checked = false);
  submitBtn.disabled = true;

  // Enable/disable button based on selection
  radioButtons.forEach(rb => {
    rb.addEventListener('change', function() {
      const anySelected = Array.from(radioButtons).some(rb => rb.checked);
      submitBtn.disabled = !anySelected;
    });
  });

  // Handle form submission - redirect immediately
  form.addEventListener('submit', function(e) {
    e.preventDefault();
    
    const selectedAnswer = form.querySelector('input[name="answer"]:checked');
    if (!selectedAnswer) return;
    
    // Disable form during submission
    submitBtn.disabled = true;
    submitBtn.style.opacity = '0.7';
    
    // Submit form directly - let browser handle redirect
    form.submit();
  });
});
</script>
{% endblock %}
